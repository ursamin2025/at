SELECT 
  ts.ENDPOINT_BACKEND,
  GROUP_CONCAT(DISTINCT ts.APP_NAME ORDER BY ts.APP_NAME SEPARATOR ', ') AS APP_NAMES,
  CASE 
    WHEN SUM(ts.STATUS = 'PASS') = COUNT(*) THEN 'UP'
    ELSE 'DOWN'
  END AS STATUS_INDICATOR
FROM cqexecution.teststeps ts
JOIN cqexecution.jenkins_execution je
  ON ts.APP_NAME = je.JOB_NAME
WHERE ts.ENDPOINT_BACKEND IS NOT NULL
  AND je.JOB_ENVIRONMENT = 'ReleaseQA'
GROUP BY ts.ENDPOINT_BACKEND
ORDER BY ts.ENDPOINT_BACKEND;
