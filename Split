SELECT 
  ts.ENDPOINT_BACKEND,
  GROUP_CONCAT(DISTINCT ts.APP_NAME ORDER BY ts.APP_NAME SEPARATOR ', ') AS APP_NAMES,
  CASE 
    WHEN SUM(ts.STATUS = 'PASS') = COUNT(*) THEN 'UP'
    ELSE 'DOWN'
  END AS STATUS_INDICATOR
FROM cqexecution.teststeps ts
WHERE ts.ENDPOINT_BACKEND IS NOT NULL
  AND ts.JOB_ENVIRONMENT_COPY = '${env}'
GROUP BY ts.ENDPOINT_BACKEND
ORDER BY ts.ENDPOINT_BACKEND;
