SELECT DISTINCT
    ts.APP_NAME AS API,
    ts.DEPLOYED_NAME,
    ts.ENDPOINT_URL,
    tc.TRACE_ID,
    tc.SESSION_ID,
    CASE 
        WHEN ts.STATUS = 'PASS' THEN 'UP' 
        ELSE 'DOWN' 
    END AS STATUS_INDICATOR
FROM cqeexecution.teststeps ts
JOIN cqeexecution.jenkins_execution_testcase tc
    ON ts.TESTCASE_ID = tc.ID
WHERE 
    (
        '${app_name}' = 'All'
        OR LOWER(ts.APP_NAME) = LOWER(${app_name})
    )
    AND (
        '${backend_name}' = 'All'
        OR LOWER(ts.ENDPOINT_BACKEND) = LOWER(${backend_name})
    )
    AND (
        '${environment}' = 'All'
        OR LOWER(ts.ENVIRONMENT) = LOWER(${environment})
    )
ORDER BY ts.ENDPOINT_URL;
